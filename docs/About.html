<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>About Us | Soyosoyo SACCO</title>
    <meta name="description" content="From 1998 Medicare roots to modern financial empowerment. The full story of Soyosoyo SACCO.">
    <link rel="stylesheet" href="./style.css?v=40">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .history-section {
            margin: 80px 0;
            padding: 30px;
            background: #f8fdfa;
            border-radius: 24px;
            border: 2px solid #86efac;
            box-shadow: 0 15px 40px rgba(0,0,0,0.08);
            font-family: 'Lato', sans-serif;
        }
        .history-header {
            text-align: center;
            color: #004d1a;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 20px;
        }
        .history-controls {
            text-align: center;
            margin: 20px 0;
            gap: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-weight: 900;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-save {
            background: #10B981;
            color: white;
        }
        .btn-save:hover { 
            background: #059669; 
            transform: translateY(-2px); 
        }
        .btn-download {
            background: #004d1a;
            color: white;
        }
        .btn-download:hover { 
            background: #166534; 
            transform: translateY(-2px); 
        }
        .btn-reload {
            background: #3b82f6;
            color: white;
        }
        .btn-reload:hover { 
            background: #2563eb; 
            transform: translateY(-2px); 
        }
        #fullHistoryTable {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        #fullHistoryTable table {
            width: 100%;
            min-width: 800px; /* Slightly reduced for better mobile fit */
            border-collapse: collapse;
            background: white;
            table-layout: fixed; /* Ensures consistent column widths */
        }
        #fullHistoryTable th {
            background: #004d1a;
            color: white;
            padding: 16px 8px; /* Reduced padding for tighter fit */
            text-align: center;
            font-weight: 900;
            font-size: 14px; /* Smaller font for mobile */
            white-space: nowrap; /* Prevent wrapping in headers */
        }
        #fullHistoryTable td {
            padding: 14px 8px; /* Reduced padding */
            text-align: center;
            border-bottom: 1px solid #e6f4ea;
            font-size: 14px;
            white-space: nowrap; /* Prevent wrapping in cells */
            overflow: hidden;
            text-overflow: ellipsis; /* Handle overflow gracefully */
        }
        #fullHistoryTable tr:hover {
            background: #fff8e1 !important;
        }
        #fullHistoryTable tr:nth-child(even) {
            background: #f0fdf4;
        }
        /* Right-align numeric columns for clarity */
        #fullHistoryTable td:nth-child(2),
        #fullHistoryTable td:nth-child(3),
        #fullHistoryTable td:nth-child(4),
        #fullHistoryTable td:nth-child(5),
        #fullHistoryTable td:nth-child(6) {
            text-align: right;
        }
        .history-footer {
            text-align: center;
            margin-top: 20px;
            color: #004d1a;
            font-weight: bold;
            font-size: 15px;
        }
        .current-month {
            background: #fff8e1 !important;
            font-weight: bold;
            box-shadow: inset 0 0 10px rgba(255,193,7,0.3);
        }
        @media (max-width: 768px) {
            .history-section {
                padding: 20px;
                margin: 40px 0;
            }
            .history-header {
                font-size: 1.5rem;
            }
            .history-controls { 
                flex-direction: column; 
                align-items: center; 
            }
            .btn { 
                width: 90%; 
                max-width: 300px; 
            }
            /* MOBILE: Transform table to vertical cards - no horizontal scroll */
            #fullHistoryTable {
                overflow-x: hidden; /* No horizontal scroll */
                display: block;
            }
            #fullHistoryTable table {
                display: none; /* Hide desktop table */
            }
            #fullHistoryTable .mobile-cards {
                display: flex;
                flex-direction: column;
                gap: 12px;
                max-height: none; /* Full flow */
            }
            #fullHistoryTable .mobile-card {
                background: white;
                border-radius: 16px;
                padding: 16px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
                border: 1px solid #e6f4ea;
                transition: all 0.3s ease; /* Smooth animation */
                animation: fadeInUp 0.3s ease forwards;
                opacity: 0;
                transform: translateY(10px);
            }
            #fullHistoryTable .mobile-card:nth-child(even) {
                background: #f0fdf4;
            }
            #fullHistoryTable .mobile-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            }
            #fullHistoryTable .mobile-card.current-month {
                background: #fff8e1 !important;
                border-color: #fbbf24;
                box-shadow: inset 0 0 10px rgba(255,193,7,0.3), 0 4px 12px rgba(0,0,0,0.05);
            }
            #fullHistoryTable .mobile-card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
                font-weight: 900;
                color: #004d1a;
                font-size: 16px;
            }
            #fullHistoryTable .mobile-card-body {
                display: grid;
                grid-template-columns: 1fr 1fr; /* 2-column grid for elegance */
                gap: 8px 16px;
                font-size: 13px;
            }
            #fullHistoryTable .mobile-card-item {
                display: flex;
                flex-direction: column;
            }
            #fullHistoryTable .mobile-card-label {
                font-size: 11px;
                color: #6b7280;
                font-weight: 700;
                margin-bottom: 2px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            #fullHistoryTable .mobile-card-value {
                font-weight: 600;
                color: #004d1a;
            }
            #fullHistoryTable .mobile-card-value.roa {
                color: #10B981;
                font-weight: bold;
            }
            #fullHistoryTable .mobile-card-value.ksh::before {
                content: "KSh ";
            }
            #fullHistoryTable .mobile-card-date {
                grid-column: span 2;
                text-align: center;
                margin-top: 8px;
                padding-top: 8px;
                border-top: 1px solid #e6f4ea;
                font-size: 12px;
                color: #6b7280;
                font-style: italic;
            }
            /* Fade-in animation for smooth flow */
            @keyframes fadeInUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            /* Stagger animation for cards */
            #fullHistoryTable .mobile-card:nth-child(1) { animation-delay: 0s; }
            #fullHistoryTable .mobile-card:nth-child(2) { animation-delay: 0.1s; }
            #fullHistoryTable .mobile-card:nth-child(3) { animation-delay: 0.2s; }
            #fullHistoryTable .mobile-card:nth-child(n+4) { animation-delay: 0.3s; }
        }
        @media (max-width: 480px) {
            #fullHistoryTable .mobile-card-body {
                grid-template-columns: 1fr; /* Single column on very small screens */
                gap: 12px 0;
            }
            #fullHistoryTable .mobile-card-date {
                grid-column: span 1;
            }
            .history-header { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

<header class="site-header">
    <div class="navbar">
        <a href="index.html"><img class="brand-logo round" src="./assets/141dd3faa98da9737b591161deac509a.jpg" alt="Logo"></a>
        <a href="https://chamasoft.com/login" class="member-portal">Member Portal</a>
        <button id="menu-toggle" aria-label="Toggle Menu"></button>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="Products.html">Products</a>
            <a href="Online-Forms.html">Online Forms</a>
            <a href="Jobs.html">Jobs</a>
            <a href="Join-Us.html">Join Us</a>
        </nav>
    </div>
</header>

<main class="container">
    <section class="section">
        <h1 style="text-align: center; margin-bottom: 1.5rem;">The Evolution of Soyosoyo SACCO</h1>
        <p style="text-align: justify; margin: 15px 0;">
            Soyosoyo SACCO boasts a rich history, beginning its journey on <strong>July 15, 1998</strong>, as <strong>SOYOSOYO MEDICARE CO-OPERATIVE SAVINGS & CREDIT SOCIETY</strong>. Its initial, heartwarming mission was to pool funds and provide affordable credit, primarily to help members cover their families' medical bills.
        </p>
        <p style="text-align: justify; margin: 15px 0;">
            As the fund grew significantly, the SACCO's vision expanded beyond healthcare. It began to support members in financing their children's education, demonstrating its adaptability and commitment to community needs.
        </p>
        <p style="text-align: justify; margin: 15px 0;">
            However, with its membership spreading across various parts of the Kenyan Coast, the complexity of managing the SACCO, combined with the introduction of the National Hospital Insurance Fund (NHIF) which began covering medical bills, led the SACCO into a period of silence.
        </p>
        <p style="text-align: justify; margin: 15px 0;">
            But the story didn't end there. In 2022, the dedicated founding members reignited their passion, showing a keen interest in reviving the SACCO. Their goal was clear: to refresh its objectives to align with current community needs.
        </p>
        <p style="text-align: justify; margin: 15px 0;">
            This revival culminated in a new beginning for Soyosoyo SACCO. Officially rebranded and given a new look on April 10, 2024, it emerged with renewed vigor. Its expanded mission now focuses on providing affordable financing to cover a broader range of essential objectives, including medical bills, education, agriculture, and development.
        </p>
        <p style="text-align: justify; margin: 15px 0;">
            Soyosoyo SACCO stands today as a testament to its enduring commitment to its members, evolving to meet the diverse financial needs of its community.
        </p>
        <div style="text-align: center; margin-top: 2rem;">
            <a href="index.html" class="products-button">Back to Home</a>
        </div>
    </section>

    <!-- MONTHLY HISTORY SECTION — ENHANCED FOR CLEAR ALIGNMENT -->
    <section class="history-section">
        <h2 class="history-header">Monthly Financial History (2025 – Present)</h2>
        <div class="history-controls">
            <button class="btn btn-save" onclick="saveCurrentMonth()">
                SAVE THIS MONTH'S DATA
            </button>
            <button class="btn btn-download" onclick="downloadHistoryCSV()">
                DOWNLOAD FULL HISTORY (CSV)
            </button>
        </div>
        <div id="fullHistoryTable"></div>
        <div class="history-footer" id="historyFooter">
            Loading monthly records...
        </div>
    </section>
</main>

<footer>
    <p>© 2025–<span id="currentYear"></span> SOYOSOYO SACCO. All rights reserved. | <a href="mailto:info@soyosoyosacco.com">info@soyosoyosacco.com</a></p>
    <div class="social-icons">
        <a href="https://www.facebook.com/people/Soyosoyo-Sacco/61565783836766/" target="_blank"><i class="fab fa-facebook-f"></i></a>
        <a href="https://x.com/SoyosoyoSACCO" target="_blank"><i class="fab fa-x-twitter"></i></a>
        <a href="https://www.instagram.com/soyosoyosacco" target="_blank"><i class="fab fa-instagram"></i></a>
    </div>
</footer>

<script>
  document.getElementById('currentYear').textContent = new Date().getFullYear();
</script>
<script src="./scripts/main.js"></script>
<script src="./scripts/carousel.js"></script>

<script>
    // MONTHLY SAVE + RENDER + DOWNLOAD — ENHANCED WITH PERSISTENCE, POINTING TO CAROUSEL DATA
    function loadPersistedData() {
        // Load history if available
        const savedHistory = localStorage.getItem('saccoHistory');
        if (savedHistory && !window.saccoHistory) {
            try {
                window.saccoHistory = JSON.parse(savedHistory);
                console.log('Recovered history from localStorage');
            } catch (e) {
                console.error('Corrupted history:', e);
                window.saccoHistory = {};
            }
        }
        // Load today data if missing (from carousel persistence)
        const savedToday = localStorage.getItem('saccoDataToday');
        if (savedToday && !window.saccoData?.today) {
            try {
                window.saccoData = { today: JSON.parse(savedToday) };
                console.log('Loaded persisted today data from carousel');
            } catch (e) {
                console.error('Corrupted today data:', e);
            }
        }
    }

    function savePersistedData() {
        if (window.saccoHistory) {
            localStorage.setItem('saccoHistory', JSON.stringify(window.saccoHistory));
        }
        if (window.saccoData?.today) {
            localStorage.setItem('saccoDataToday', JSON.stringify(window.saccoData.today));
        }
    }

    function saveCurrentMonth() {
        loadPersistedData();  // Ensure latest is loaded from carousel persistence

        if (!window.saccoData?.today) {
            alert("No current data. Please visit the homepage first to load metrics via carousel.");
            return;
        }

        // Convert ROA string to number if needed
        const today = { ...window.saccoData.today };
        if (typeof today.roa === 'string') {
            today.roa = parseFloat(today.roa);
        }

        // Validate key fields
        if (isNaN(today.members) || isNaN(today.contributions)) {
            alert("Invalid data format. Check homepage carousel metrics.");
            return;
        }

        if (!window.saccoHistory) window.saccoHistory = {};
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const key = `${year}-${month}`;

        // Always overwrite for the current month to capture daily carousel updates
        window.saccoHistory[key] = {
            period: key,
            members: today.members,
            contributions: today.contributions,
            loans: today.loans || 0,
            bankBalance: today.bankBalance || 0,
            profit: today.profit || 0,
            roa: today.roa || 0,
            dateSaved: date.toISOString().split('T')[0]
        };

        savePersistedData();  // Persist immediately
        renderFullHistory();
        const action = window.saccoHistory[key] && date.toISOString().split('T')[0] !== (window.saccoHistory[key].dateSaved || '') ? 'UPDATED' : 'SAVED';
        alert(`MONTHLY DATA ${key} ${action} WITH LATEST CAROUSEL METRICS! (Members: ${today.members.toLocaleString()})`);
        console.log("Saved/Updated from carousel data:", window.saccoHistory[key]);
    }

    function renderFullHistory() {
        loadPersistedData();
        const tableContainer = document.getElementById('fullHistoryTable');
        const footer = document.getElementById('historyFooter');
        if (!tableContainer) return;

        if (!window.saccoHistory || Object.keys(window.saccoHistory).length === 0) {
            tableContainer.innerHTML = `<p style="text-align:center; color:#6b7280; padding:40px;">No monthly data saved yet. Click the green button to start! (Data sourced from homepage carousel)</p>`;
            footer.textContent = "Start saving your monthly growth today.";
            return;
        }

        const periods = Object.keys(window.saccoHistory).sort().reverse(); // newest first
        const currentMonth = new Date().toISOString().slice(0,7); // "2025-11"

        // Desktop Table
        let desktopHTML = `
            <table>
                <thead>
                    <tr>
                        <th>Period</th>
                        <th>Members</th>
                        <th>Contributions</th>
                        <th>Loans</th>
                        <th>Bank Balance</th>
                        <th>ROA %</th>
                        <th>Saved On</th>
                    </tr>
                </thead>
                <tbody>
                    ${periods.map(key => {
                        const d = window.saccoHistory[key];
                        const isCurrent = key === currentMonth;
                        return `
                            <tr ${isCurrent ? 'class="current-month"' : ''}>
                                <td style="font-weight:900; color:#004d1a;">${d.period || key}</td>
                                <td>${d.members?.toLocaleString() || '—'}</td>
                                <td>KSh ${d.contributions?.toLocaleString() || '—'}</td>
                                <td>KSh ${d.loans?.toLocaleString() || '—'}</td>
                                <td>KSh ${d.bankBalance?.toLocaleString() || '—'}</td>
                                <td style="color:#10B981; font-weight:bold;">${d.roa || '—'}%</td>
                                <td>${d.dateSaved || '—'}</td>
                            </tr>
                        `;
                    }).join('')}
                </tbody>
            </table>
        `;

        // Mobile Cards - Vertical flow, no scroll
        let mobileHTML = `
            <div class="mobile-cards">
                ${periods.map((key, index) => {
                    const d = window.saccoHistory[key];
                    const isCurrent = key === currentMonth;
                    return `
                        <div class="mobile-card ${isCurrent ? 'current-month' : ''}">
                            <div class="mobile-card-header">
                                <span>${d.period || key}</span>
                                <span style="font-size: 12px; color: #6b7280;">Month Overview</span>
                            </div>
                            <div class="mobile-card-body">
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">Members</span>
                                    <span class="mobile-card-value">${d.members?.toLocaleString() || '—'}</span>
                                </div>
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">Contributions</span>
                                    <span class="mobile-card-value ksh">${d.contributions?.toLocaleString() || '—'}</span>
                                </div>
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">Loans</span>
                                    <span class="mobile-card-value ksh">${d.loans?.toLocaleString() || '—'}</span>
                                </div>
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">Bank Balance</span>
                                    <span class="mobile-card-value ksh">${d.bankBalance?.toLocaleString() || '—'}</span>
                                </div>
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">ROA</span>
                                    <span class="mobile-card-value roa">${d.roa || '—'}%</span>
                                </div>
                                <div class="mobile-card-item">
                                    <span class="mobile-card-label">Profit</span>
                                    <span class="mobile-card-value ksh">${d.profit?.toLocaleString() || '—'}</span>
                                </div>
                            </div>
                            <div class="mobile-card-date">Saved on ${d.dateSaved || '—'}</div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;

        tableContainer.innerHTML = desktopHTML + mobileHTML;

        const totalSize = (JSON.stringify(window.saccoHistory).length / 1024).toFixed(1);
        footer.innerHTML = `
            Total Records: <strong>${periods.length}</strong> | 
            First: <strong>${periods[periods.length-1]}</strong> | 
            Latest: <strong>${periods[0]}</strong> |
            <span style="color:#10B981;">Space used: ~${totalSize} KB (Persisted from carousel)</span>
        `;
    }

    function downloadHistoryCSV() {
        loadPersistedData();
        if (!window.saccoHistory || Object.keys(window.saccoHistory).length === 0) {
            alert("No data to download yet.");
            return;
        }
        const periods = Object.keys(window.saccoHistory).sort();
        let csv = "Period,Members,Contributions (KSh),Loans (KSh),Bank Balance (KSh),ROA %,Date Saved\n";
        periods.forEach(key => {
            const d = window.saccoHistory[key];
            csv += `${d.period || key},${d.members || ''},${d.contributions || ''},${d.loans || ''},${d.bankBalance || ''},${d.roa || ''},${d.dateSaved || ''}\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `SOYOSOYO_SACCO_MONTHLY_HISTORY_${new Date().getFullYear()}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    }

    // BONUS: Clear all data (for testing/resets)
    function clearAllData() {
        if (confirm('Clear all saved monthly data? This is permanent!')) {
            localStorage.removeItem('saccoHistory');
            localStorage.removeItem('saccoDataToday');
            window.saccoHistory = {};
            window.saccoData = {}; // Careful: this wipes current too
            renderFullHistory();
            alert('All data cleared.');
        }
    }

    // AUTO-RENDER
    document.addEventListener('DOMContentLoaded', () => {
        loadPersistedData();
        renderFullHistory();
    });
    window.addEventListener('saccoDataUpdated', () => {
        savePersistedData();
        renderFullHistory();
    });
    setTimeout(() => {
        loadPersistedData();
        renderFullHistory();
    }, 1000);
</script>

<script>
  // AUTO-YEAR MAGIC — UPDATES EVERY YEAR TEXT AUTOMATICALLY
  document.addEventListener('DOMContentLoaded', () => {
    const currentYear = new Date().getFullYear();
    const startYear = 2025; // Change only if you want a different base year

    // Update copyright
    document.querySelectorAll('footer p, .copyright, [class*="copyright"], [id*="copyright"]').forEach(el => {
      if (el.textContent.includes('©')) {
        el.innerHTML = el.innerHTML.replace(/\d{4}(?=\s*SOYOSOYO|\s*$)/, currentYear);
      }
    });

    // Update any "2025" in titles, headers, or text
    document.querySelectorAll('h1, h2, h3, p, span, div, li').forEach(el => {
      if (el.textContent.includes('2025')) {
        el.innerHTML = el.innerHTML.replace(/2025/g, currentYear);
      }
    });

    // Special: Update "5-Year Growth Strategy" → "6-Year", etc.
    document.querySelectorAll('.summary-header, h2').forEach(el => {
      if (el.textContent.includes('Year Growth Strategy')) {
        const yearsAhead = currentYear - startYear + 5;
        el.textContent = `${yearsAhead}-Year Growth Strategy`;
      }
    });

    // Special: Update "Monthly Financial History (2025 – Present)"
    document.querySelectorAll('.history-header').forEach(el => {
      if (el.textContent.includes('2025')) {
        el.textContent = el.textContent.replace('2025', currentYear);
      }
    });

    // Special: Update any "2025–Present" pattern
    document.querySelectorAll('*').forEach(el => {
      if (el.textContent.includes('2025 – Present') || el.textContent.includes('2025-Present')) {
        el.innerHTML = el.innerHTML.replace(/2025(?=\s*[–-]\s*Present)/g, currentYear);
      }
    });

    // Update footer year only
    document.querySelectorAll('footer').forEach(footer => {
      footer.innerHTML = footer.innerHTML.replace(/©\s*\d{4}/, `© ${currentYear}`);
    });
  });
</script>

<script>
  if (!window.saccoData) {
    fetch('https://soyosoyosacco.com/data.json')
      .then(r => r.json())
      .then(d => {
        window.saccoData = d;
        window.dispatchEvent(new Event('saccoDataUpdated'));
      });
  }
</script>
</body>
</html>
