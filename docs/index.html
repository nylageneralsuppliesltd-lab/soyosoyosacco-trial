<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - SOYOSOYO SACCO</title>
    <link rel="icon" href="./assets/141dd3faa98da9737b591161deac509a.jpg">
    <link rel="stylesheet" href="./style.css">
    <style>
        /* Light Green Theme for Navbar Only */
        .navbar { 
            background-color: #90EE90 !important; 
            color: #006400; 
            padding: 10px 0;
        }
        .nav-links a { 
            color: #006400; 
            text-decoration: none; 
            padding: 10px; 
        }
        .nav-links a:hover { 
            color: #228B22; 
        }
        
        /* Hero: Full Image, No Transparency */
        .hero { 
            background-image: url('./assets/header-image.jpg') !important; 
            background-size: cover; 
            background-position: center; 
            height: 50vh; 
            position: relative; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
        }
        .hero::before { 
            content: none;
        }
        
        /* Container for proper width */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
            align-items: stretch;
        }

        /* Section flow */
        section { 
            margin: 20px 0; 
            padding: 20px; 
            flex: 1 1 100%;
        }
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        .product-card { 
            border: 1px solid #90EE90; 
            padding: 15px; 
            border-radius: 8px; 
            background: white; 
        }
        .product-card img { 
            width: 100%; 
            height: 200px; 
            object-fit: cover; 
            border-radius: 4px; 
        }
        .tool-section { 
            background: #f9f9f9; 
            padding: 30px; 
            border-radius: 8px; 
            margin: 20px auto; 
            max-width: 800px; 
            width: 100%; 
            box-sizing: border-box;
        }
        .calculator-wrapper, .calculator {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            min-height: 350px;
            overflow-y: auto;
            padding-bottom: 20px;
        }
        .calculator select, .calculator input, .calculator button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #90EE90;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .calculator button {
            background: #90EE90;
            color: #006400;
            cursor: pointer;
            font-weight: bold;
        }
        .calculator button:hover {
            background: #228B22;
            color: white;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            font-size: 16px;
            min-height: 100px;
            background: #ffffff;
            border: 1px solid #90EE90;
            border-radius: 4px;
            text-align: left;
            line-height: 1.6;
            color: #333;
        }
        .month-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .month-inputs input {
            width: 100%;
        }
        #bot-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: min(90vw, 350px);
            height: min(80vh, 500px);
            border: 1px solid #90EE90;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        #chatMessages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f9f9f9;
            border-bottom: 1px solid #90EE90;
        }
        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid #90EE90;
            display: flex;
            gap: 10px;
        }
        #messageInput {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            resize: none;
            font-family: Arial, sans-serif;
        }
        .send-button {
            background: linear-gradient(135deg, #7dd3c0 0%, #1e7b85 100%);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .chat-header {
            background: linear-gradient(135deg, #7dd3c0 0%, #1e7b85 100%);
            color: white;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
        }
        .chat-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        .header-text h3 {
            font-size: 14px;
            margin: 0;
        }
        .header-text p {
            font-size: 11px;
            opacity: 0.9;
            margin: 0;
        }
        .minimize-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
        }
        .minimize-button svg {
            fill: white;
        }
        .message {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        .message.user {
            flex-direction: row-reverse;
        }
        .message-bubble {
            max-width: 80%;
            padding: 10px;
            border-radius: 12px;
            font-size: 13px;
            line-height: 1.4;
        }
        .message.user .message-bubble {
            background: #3b82f6;
            color: white;
        }
        .message.assistant .message-bubble {
            background: #f1f5f9;
            color: #374151;
            border: 1px solid #e5e7eb;
        }
        .error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
        /* Carousel Styles */
        .carousel-wrapper {
            width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .carousel-container {
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            position: relative;
            padding: 40px 0;
            background: #d0d0d0;
            box-sizing: border-box;
        }
        .carousel {
            display: flex;
            flex-wrap: nowrap;
            animation: slide var(--carousel-duration, 21s) linear infinite;
        }
        .carousel-item {
            flex: 0 0 auto;
            min-width: 0;
            width: 300px;
            margin: 0 40px;
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        .carousel-button {
            background: #87CEEB;
            color: white;
            padding: 20px 30px;
            border-radius: 8px;
            border: none;
            font-family: Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            display: block;
            width: 100%;
            text-align: center;
            text-decoration: none;
            box-sizing: border-box;
        }
        .carousel-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        .carousel-description {
            margin-top: 15px;
            font-family: Arial, sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            box-sizing: border-box;
        }
        .carousel:hover {
            animation-play-state: paused;
        }
        @keyframes slide {
            0% { transform: translateX(0); }
            100% { transform: translateX(var(--carousel-translate, -2380px)); }
        }
        /* Mission, Vision, Core Values Containers */
        .mission-vision-container, .core-values-container {
            background: #ffffff;
            border: 1px solid #90EE90;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 100, 0, 0.1); /* Classy shadow with theme color */
            padding: 20px;
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            box-sizing: border-box;
            text-align: center;
        }
        .core-values-container {
            max-width: 800px; /* Slightly wider for core values */
        }
        .mission-vision-container img, .core-values-container img {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .core-values-container ul {
            list-style-type: square;
            padding-left: 40px;
            line-height: 1.6;
            text-align: left;
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            .mission-vision-container, .core-values-container {
                max-width: 100%;
            }
        }
        @media (min-width: 769px) {
            .mission-vision-container {
                flex: 1 1 calc(50% - 20px); /* Two columns for Mission and Vision */
            }
            .core-values-container {
                flex: 1 1 100%; /* Full width for Core Values */
            }
        }
        @media (max-width: 600px) {
            .carousel-item { width: 180px; margin: 0 20px; padding: 12px; }
            .carousel-button { padding: 12px 18px; font-size: 16px; }
            .carousel-description { font-size: 14px; }
            .carousel-container { padding: 20px 0; }
        }
        @media (max-width: 360px) {
            .carousel-item { width: 140px; margin: 0 10px; padding: 8px; }
            .carousel-button { padding: 8px 12px; font-size: 14px; }
            .carousel-description { font-size: 12px; }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container navbar">
            <a href="index.html"><img class="brand-logo" src="./assets/141dd3faa98da9737b591161deac509a.jpg" alt="Soyosoyo Sacco Logo" style="max-width: 100px;"></a>
            <button id="menu-toggle" aria-label="Toggle Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="Products.html">Products</a></li>
                    <li><a href="Online Forms.html">Online Forms</a></li>
                    <li><a href="Jobs.html">Jobs</a></li>
                    <li><a href="Join Us.html">Join Us</a></li>
                </ul>
            </nav>
        </div>
        <div class="hero"></div>
    </header>

    <main class="container">
        <!-- Evolution Section -->
        <section class="section">
            <h1 style="text-align: center; font-family: Lato, Arial; font-weight: 700;">The Evolution of Soyosoyo SACCO: From Medicare to Modern Empowerment</h1>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                Soyosoyo SACCO boasts a rich history, beginning its journey on <strong>July 15, 1998</strong>, as <strong>SOYOSOYO MEDICARE CO-OPERATIVE SAVINGS & CREDIT SOCIETY</strong>. Its initial, heartwarming mission was to pool funds and provide affordable credit, primarily to help members cover their families' medical bills.
            </p>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                As the fund grew significantly, the SACCO's vision expanded beyond healthcare. It began to support members in financing their children's education, demonstrating its adaptability and commitment to community needs.
            </p>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                However, with its membership spreading across various parts of the Kenyan Coast, the complexity of managing the SACCO, combined with the introduction of the National Hospital Insurance Fund (NHIF) which began covering medical bills, led the SACCO into a period of silence.
            </p>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                But the story didn’t end there. In 2022, the dedicated founding members reignited their passion, showing a keen interest in reviving the SACCO. Their goal was clear: to refresh its objectives to align with current community needs.
            </p>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                This revival culminated in a new beginning for Soyosoyo SACCO. Officially rebranded and given a new look on April 10, 2024, it emerged with renewed vigor. Its expanded mission now focuses on providing affordable financing to cover a broader range of essential objectives, including medical bills, education, agriculture, and development.
            </p>
            <p style="text-align: justify; line-height: 1.6; margin: 20px 0;">
                Soyosoyo SACCO stands today as a testament to its enduring commitment to its members, evolving to meet the diverse financial needs of its community.
            </p>
        </section>

        <!-- Mission and Vision Section -->
        <div class="mission-vision-container">
            <img src="./assets/0065564ad0f92baf9be886b031073979.jpg" alt="Mission Image">
            <h2>Our Mission</h2>
            <p style="line-height: 1.6;">
                To continually empower members by providing accessible, affordable, and innovative credit for healthcare, education, agriculture, and development, driving enduring prosperity in our cooperative community.
            </p>
        </div>

        <div class="mission-vision-container">
            <img src="./assets/d8c3d49708ed9831ff753b3548c717aa.jpg" alt="Vision Image">
            <h2>Our Vision</h2>
            <p style="line-height: 1.6;">
                To be the leading catalyst for financial transformation and sustainable prosperity across Kenya, empowering every member to achieve their aspirations in health, education, and development.
            </p>
        </div>

        <!-- Core Values Section -->
        <div class="core-values-container">
            <img src="./assets/8119c4ebd64ccbe641d0563d23444c34.jpg" alt="Values Image">
            <h2>Our Core Values</h2>
            <ul style="list-style-type: square; padding-left: 40px; line-height: 1.6;">
                <li><strong>Empowerment</strong></li>
                <li><strong>Integrity</strong></li>
                <li><strong>Community</strong></li>
                <li><strong>Accessibility</strong></li>
                <li><strong>Growth</strong></li>
            </ul>
        </div>

        <!-- Products Section -->
        <section class="section">
            <h1 style="text-align: center; font-family: Lato, Arial; font-weight: 700;">OUR PRODUCTS</h1>
            <div class="products-grid">
                <div class="product-card">
                    <img src="./assets/ba04cd4377b3746fc0750dcf2ff3d935.jpg" alt="Education Loan">
                    <h2 style="text-align: center;">Education Loan</h2>
                    <p>Dreaming of a brighter future through education? An <strong>education loan</strong> can turn that dream into reality! Don’t let financial hurdles block your academic aspirations. This specialized loan is designed to cover tuition, accommodation, books, and living expenses, making education accessible to everyone.</p>
                    <a href="Products.html" class="products-button" style="display: block; text-align: center; background: #90EE90; color: #006400; padding: 10px; text-decoration: none; border-radius: 4px; margin-top: 10px;">View Product</a>
                </div>
            </div>
        </section>

        <!-- Stats Carousel -->
        <div class="carousel-wrapper">
            <div class="carousel-container">
                <div class="carousel"></div>
            </div>
        </div>

        <!-- Loan Calculator -->
        <section class="tool-section" id="loan-calculator">
            <h2 style="text-align: center;">Loan Calculator</h2>
            <div class="calculator-wrapper">
                <div class="calculator">
                    <select id="loanType" onchange="updateFields()">
                        <option value="">Select Loan Type</option>
                        <option value="emergency">Emergency Loan</option>
                        <option value="medicare">Medicare Loan</option>
                        <option value="education">Education Loan</option>
                        <option value="development">Development Loan</option>
                        <option value="apiCulture">Api Culture Loan</option>
                    </select>
                    <div class="form-group interest-rate">
                        <label for="rate">Annual Interest Rate (%):</label>
                        <input type="text" id="rate" readonly placeholder="Select a loan type">
                    </div>
                    <div class="form-group tenure">
                        <label for="tenure">Tenure (Months):</label>
                        <input type="text" id="tenure" readonly placeholder="Select a loan type">
                    </div>
                    <div class="form-group slider-container">
                        <label for="principalSlider">Loan Amount (KES):</label>
                        <input type="range" id="principalSlider" min="1000" max="1000000" step="1000" value="1000">
                        <div class="slider-value" id="principalValue">KES 1000</div>
                    </div>
                    <button onclick="calculateLoan()">Calculate Loan</button>
                    <div class="result" id="result"></div>
                    <button onclick="toggleAmortizationTable()" id="amortizationButton" style="display: none;">View Amortization Table</button>
                    <div class="amortization-table" id="amortizationTable" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Payment (KES)</th>
                                    <th>Principal (KES)</th>
                                    <th>Interest (KES)</th>
                                    <th>Balance (KES)</th>
                                </tr>
                            </thead>
                            <tbody id="amortizationBody"></tbody>
                        </table>
                    </div>
                    <button onclick="showFinesSection()" id="finesPromptButton" style="display: none;">Calculate Fines for Missed Payments</button>
                    <button onclick="toggleChart()" id="chartButton" style="display: none;">View Chart</button>
                    <div class="loan-chart" id="loanChart" style="display: none;"></div>
                    <div class="fines-section" id="finesSection" style="display: none;">
                        <h3>Calculate Late Repayment Fines</h3>
                        <div class="form-group">
                            <label for="lateMonth">Month of First Missed Payment:</label>
                            <input type="number" id="lateMonth" placeholder="e.g., 1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="monthsLate">Number of Consecutive Missed Payments:</label>
                            <input type="number" id="monthsLate" placeholder="e.g., 3" min="0">
                        </div>
                        <div class="form-group" id="paymentGroup" style="display: none;">
                            <label for="paymentMonth">Month to Add Payment:</label>
                            <input type="number" id="paymentMonth" placeholder="e.g., 4" min="1">
                            <label for="paymentAmount">Amount Paid (KES):</label>
                            <input type="number" id="paymentAmount" placeholder="e.g., 500" min="0">
                            <button onclick="addPayment()">Add Payment</button>
                        </div>
                        <button onclick="calculateFines()">Calculate Fines</button>
                        <div class="result" id="finesResult"></div>
                        <button onclick="toggleFinesAmortizationTable()" id="finesAmortizationButton" style="display: none;">View Amortization Table with Fines</button>
                        <div class="fines-amortization-table" id="finesAmortizationTable" style="display: none;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Payment (KES)</th>
                                        <th>Principal (KES)</th>
                                        <th>Interest (KES)</th>
                                        <th>Installment Fine (KES)</th>
                                        <th>Outstanding Fine (KES)</th>
                                        <th>Balance (KES)</th>
                                    </tr>
                                </thead>
                                <tbody id="finesAmortizationBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <noscript><div class="error-message">JavaScript is disabled. Please enable JavaScript to use the loan calculator.</div></noscript>
                </div>
            </div>
        </section>

        <!-- Dividends Calculator -->
        <section class="tool-section" id="dividends-calculator">
            <h2 style="text-align: center;">Dividends Calculator</h2>
            <div class="calculator">
                <label for="dividendRate">Dividend Rate (%):</label>
                <input type="number" id="dividendRate" placeholder="Enter annual dividend rate" step="0.01">
                <div class="month-inputs">
                    <input type="number" id="jan" placeholder="Jan Shares">
                    <input type="number" id="feb" placeholder="Feb Shares">
                    <input type="number" id="mar" placeholder="Mar Shares">
                    <input type="number" id="apr" placeholder="Apr Shares">
                    <input type="number" id="may" placeholder="May Shares">
                    <input type="number" id="jun" placeholder="Jun Shares">
                    <input type="number" id="jul" placeholder="Jul Shares">
                    <input type="number" id="aug" placeholder="Aug Shares">
                    <input type="number" id="sep" placeholder="Sep Shares">
                    <input type="number" id="oct" placeholder="Oct Shares">
                    <input type="number" id="nov" placeholder="Nov Shares">
                    <input type="number" id="dec" placeholder="Dec Shares">
                </div>
                <button onclick="calculateDividend()">Calculate Dividend</button>
                <div class="result" id="dividendResult"></div>
            </div>
        </section>

        <!-- Chatbot Embed -->
        <section class="tool-section" id="chatbot">
            <h2 style="text-align: center;">Chat with Us</h2>
            <div id="bot-container">
                <p>Click the button below to start a conversation!</p>
                <button id="openChatButton" style="background: #90EE90; color: #006400; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;">Open Chatbot</button>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 SOYOSOYO SACCO. All rights reserved. | <a href="mailto:info@soyosoyosacco.com">info@soyosoyosacco.com</a></p>
    </footer>

    <!-- Chatbot Container -->
    <div id="chatbot-container">
        <div class="chat-header">
            <div class="chat-header-info">
                <div class="chat-avatar">
                    <img src="./assets/soyosoyo-logo.png" alt="SOYOSOYO SACCO" onerror="this.style.display='none'">
                </div>
                <div class="header-text">
                    <h3>Chat with SOYOSOYO SACCO</h3>
                    <p>Assistant Online</p>
                </div>
            </div>
            <button id="minimizeButton" class="minimize-button">
                <svg width="16" height="16" fill="white" viewBox="0 0 16 16">
                    <path d="M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z"/>
                </svg>
            </button>
        </div>
        <div id="chatMessages" class="chat-messages"></div>
        <div class="chat-input">
            <div class="chat-input-container">
                <textarea id="messageInput" class="chat-input-field" placeholder="Ask about loans, savings, membership..." rows="1"></textarea>
                <button id="sendButton" class="send-button">
                    <svg width="14" height="14" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M28 16L4 28V20L20 16L4 12V4L28 16Z" fill="white"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./scripts/main.js"></script>
    <script src="./scripts/calculator.js"></script>
    <script src="./scripts/dividendscalculator.js"></script>
    <script src="./scripts/chatbot.js"></script>
    <script src="./scripts/carousel.js"></script>
    <script>
        // SOYOSOYO SACCO Chatbot - Inline Working Version
        (function() {
            'use strict';
            
            class SoyosoyoChat {
                constructor() {
                    this.widget = document.getElementById('chatbot-container');
                    this.messages = document.getElementById('chatMessages');
                    this.input = document.getElementById('messageInput');
                    this.sendBtn = document.getElementById('sendButton');
                    this.closeBtn = document.getElementById('minimizeButton');
                    this.openBtn = document.getElementById('openChatButton');
                    
                    this.conversationId = null;
                    this.isLoading = false;
                    this.started = false;
                    this.apiUrl = 'https://soyosoyosacco123.onrender.com/api/chat';
                    
                    if (!this.widget || !this.messages || !this.input || !this.sendBtn || !this.closeBtn || !this.openBtn) {
                        console.error('Chatbot: Missing elements');
                        return;
                    }
                    
                    this.init();
                }
                
                init() {
                    // Open button
                    this.openBtn.onclick = () => this.open();
                    
                    // Close button
                    this.closeBtn.onclick = () => this.close();
                    
                    // Send button
                    this.sendBtn.onclick = () => this.send();
                    
                    // Enter key
                    this.input.onkeypress = (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            this.send();
                        }
                    };
                    
                    // Auto-resize textarea
                    this.input.oninput = () => {
                        this.input.style.height = 'auto';
                        this.input.style.height = Math.min(this.input.scrollHeight, 80) + 'px';
                    };
                    
                    console.log('✅ SOYOSOYO chatbot ready');
                }
                
                open() {
                    this.widget.style.display = 'flex';
                    
                    if (!this.started) {
                        this.started = true;
                        this.addMsg(
                            "Hello! I'm the SOYOSOYO SACCO Assistant. I can help you with information about our services, loans, savings products, and membership requirements. How can I assist you today? 🏦",
                            'assistant'
                        );
                    }
                    
                    this.input.focus();
                }
                
                close() {
                    this.widget.style.display = 'none';
                }
                
                async send() {
                    const text = this.input.value.trim();
                    if (!text || this.isLoading) return;
                    
                    this.input.value = '';
                    this.input.style.height = 'auto';
                    this.isLoading = true;
                    
                    this.addMsg(text, 'user');
                    const typingId = this.addMsg('Typing...', 'assistant', true);
                    
                    try {
                        const response = await fetch(this.apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                message: text,
                                conversationId: this.conversationId,
                                includeContext: true
                            })
                        });
                        
                        document.getElementById(typingId)?.remove();
                        
                        if (!response.ok) {
                            throw new Error('Server error: ' + response.status);
                        }
                        
                        const data = await response.json();
                        
                        if (data.response) {
                            this.addMsg(data.response, 'assistant');
                            this.conversationId = data.conversationId;
                        } else {
                            throw new Error('Invalid response');
                        }
                        
                    } catch (error) {
                        console.error('Chat error:', error);
                        document.getElementById(typingId)?.remove();
                        this.addMsg("Sorry, I'm having trouble connecting. Please try again. 🔄", 'assistant');
                    } finally {
                        this.isLoading = false;
                        this.input.focus();
                    }
                }
                
                addMsg(text, role, isTyping = false) {
                    const id = 'msg-' + Date.now();
                    const msgDiv = document.createElement('div');
                    msgDiv.id = id;
                    msgDiv.className = 'message ' + role;
                    
                    const bubble = document.createElement('div');
                    bubble.className = 'message-bubble';
                    bubble.textContent = text;
                    
                    if (isTyping) {
                        bubble.style.fontStyle = 'italic';
                        bubble.style.color = '#999';
                    }
                    
                    msgDiv.appendChild(bubble);
                    this.messages.appendChild(msgDiv);
                    this.messages.scrollTop = this.messages.scrollHeight;
                    
                    return id;
                }
            }
            
            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🚀 Initializing SOYOSOYO SACCO chatbot...');
                window.soyosoyoChat = new SoyosoyoChat();
            });
        })();
    </script>
</body>
</html>
