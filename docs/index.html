<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msvalidate.01" content="858002EEAD3486E0F9BDC0652A4071B4" />
    <title>Soyosoyo SACCO | Affordable Loans & Savings in Coastal Kenya</title>
    <meta name="description" content="Join Soyosoyo SACCO for 1% monthly loans, high dividends, and financial empowerment. Emergency, education, and development loans available in Mombasa, Kilifi, Kwale.">
    <meta name="keywords" content="SACCO Kenya, loans Mombasa, savings cooperative, emergency loan, education loan, Soyosoyo SACCO">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Soyosoyo SACCO | Affordable Loans & Savings in Coastal Kenya">
    <meta property="og:description" content="Join Soyosoyo SACCO for 1% monthly loans, high dividends, and financial empowerment.">
    <meta property="og:image" content="https://soyosoyosacco.com/assets/141dd3faa98da9737b591161deac509a.jpg">
    <meta property="og:url" content="https://soyosoyosacco.com/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Soyosoyo SACCO | Affordable Loans & Savings">
    <meta name="twitter:description" content="1% monthly loans in Coastal Kenya. Join with KSh 200!">
    <meta name="twitter:image" content="https://soyosoyosacco.com/assets/141dd3faa98da9737b591161deac509a.jpg">
    <link rel="canonical" href="https://soyosoyosacco.com/">
    <link rel="icon" href="./assets/141dd3faa98da9737b591161deac509a.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-3.2.0.min.js"></script>
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="./style.css?v=208">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05M38MYK0G"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05M38MYK0G');
    </script>

<style id="final-working-styles">
  /* PERFECTLY CENTERED + REDUCED + CLEAN — NOV 19, 2025 FINAL */

<style id="final-working-styles">
/* FINAL — WORKS 100% WITH YOUR CURRENT HTML — 19 Nov 2025 */
.growth-charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
  gap: 1.8rem;
  margin: 3.5rem auto 3rem;
  padding: 0 12px;
  max-width: 1480px;
  justify-content: center;
}

.chart-card {
  background: #fff;
  padding: 1.3rem 1rem 1.6rem;
  border-radius: 24px;
  box-shadow: 0 12px 36px rgba(0,0,0,0.10);
  height: 520px !important;
  width: 100%;
  max-width: 400px !important;        /* ← your loved width back */
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  border: 1.5px solid #f0fdf4;
  overflow: hidden;
  box-sizing: border-box;
}

/* Title — tighter, fits even long ones (ROA, Liquidity) */
.chart-card > p {
  margin: 0 0 4px;
  font-weight: 900;
  font-size: 1.26rem;
  color: #004d1a;
  text-transform: uppercase;
  text-align: center;
  line-height: 1.25;
}

/* Arrow + % — fully visible, tight spacing */
.growth-indicator {
  margin: 6px auto 12px !important;
  font-size: 1.48rem;
  font-weight: 900;
  padding: 7px 18px;
  background: rgba(240,253,244,0.98);
  border-radius: 16px;
  width: fit-content;
  box-shadow: 0 3px 10px rgba(0,0,0,0.08);
}

/* Plot area — compresses internal Plotly spacing */
.chart-card > div[id^="plot"] {
  flex: 1;
  position: relative;
  margin-top: -12px;           /* pulls chart up */
  padding-bottom: 68px;        /* reserves space for yield box */
}

/* Remove big middle percentage */
.js-plotly-plot .plotly .annotation,
.js-plotly-plot .plotly .annotation text { display: none !important; }

/* PIE CHART ONLY — perfect spacing, no overlap */
#plotLoanTypes {
  padding-bottom: 78px !important;
}

#projectedYield {
  position: absolute !important;
  bottom: 12px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  width: calc(100% - 48px) !important;
  padding: 12px 18px !important;
  background: linear-gradient(135deg,#10B981,#34D399);
  color: #fff;
  font-weight: 900;
  font-size: 1.48rem !important;
  border-radius: 16px;
  box-shadow: 0 6px 22px rgba(16,185,129,0.5);
  z-index: 20;
}

/* Compress Plotly internal spacing so long titles fit */
.js-plotly-plot .main-svg {
  transform: translateY(-10px) !important;
}
.js-plotly-plot .plot-container {
  margin-top: -10px !important;
}

/* Mobile — everything visible */
@media (max-width: 768px) {
  .chart-card {
    height: 490px !important;
    max-width: 380px !important;
  }
  .chart-card > p { font-size: 1.22rem; }
  .growth-indicator {
    font-size: 1.42rem;
    padding: 6px 16px;
    margin: 4px auto 10px !important;
  }
  #projectedYield {
    font-size: 1.38rem !important;
    padding: 11px 15px !important;
    bottom: 10px !important;
  }
  .js-plotly-plot .main-svg { transform: translateY(-8px) !important; }
}
    
  /* Keep all your projection & other styles untouched */
  #financialCharts, .financial-chart-container { width: 100%; overflow-x: auto; overflow-y: visible; contain: layout style paint; padding: 0.75rem; }
  .financial-chart { background: #ffffff; border-radius: 20px; padding: 0.75rem; box-shadow: 0 8px 25px rgba(0,0,0,0.08); margin-bottom: 1.5rem; min-height: 500px; display: flex; flex-direction: column; }
  .financial-chart > div[id^="plot"], .plotly-financial-div, .js-plotly-plot { width: 100% !important; height: 100% !important; min-height: 400px !important; flex: 1; overflow: visible !important; }
  .plot-container { flex-grow: 1; min-height: 400px; overflow: visible; contain: layout style paint; }

  #projectionsChart { isolation: isolate; contain: layout style paint; max-width: 1400px; margin: 0 auto; padding: 0 10px; font-family: 'Lato', sans-serif; }
  #projectionsChart > .kpi-card, #projectionsChart > .summary-card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid #f0fdf4; margin: 16px 8px; max-width: calc(100% - 16px); }
  #projectionsChart .kpi-title { padding: 16px; background: #f8fdfa; text-align: center; font-size: 16px; font-weight: 900; color: #004d1a; }
  #projectionsChart .plotly-projection-div { height: 420px !important; width: 100% !important; }
  #projectionsChart .summary-header { background: linear-gradient(90deg,#004d1a,#10B981); color: white; padding: 16px; text-align: center; font-size: 17px; font-weight: 900; }
  #projectionsChart .summary-grid { display: grid; grid-template-columns: 1fr; gap: 14px; padding: 16px; }
  #projectionsChart .summary-item { background: #f0fdf4; border-radius: 14px; padding: 12px; border: 1px solid #86efac; text-align: center; }
  #projectionsChart .summary-label { font-size: 13.5px; font-weight: 900; color: #166534; }
  #projectionsChart .summary-values { display: flex; justify-content: space-between; font-size: 13px; margin: 8px 0; }
  #projectionsChart .summary-values span { color: #6b7280; font-size: 11.5px; display: block; }
  #projectionsChart .summary-values strong { font-size: 15px; color: #004d1a; }
  #projectionsChart .summary-growth { background: #10B981; color: white; padding: 6px 14px; border-radius: 50px; font-size: 12.5px; font-weight: 900; }

  @media (min-width: 769px) {
    #projectionsChart { display: flex; flex-wrap: wrap; justify-content: space-between; }
    #projectionsChart > .kpi-card { flex: 1 1 calc(50% - 20px); max-width: 48%; }
    #projectionsChart .plotly-projection-div { height: 440px !important; }
    #projectionsChart > .summary-card { flex: 1 1 100%; max-width: 100%; margin: 30px 8px 10px; }
    #projectionsChart .summary-grid { grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 20px; }
    #projectionsChart .summary-values strong { font-size: 17px; }
    #projectionsChart .summary-growth { padding: 8px 16px; font-size: 13px; }
  }

  @media (max-width: 768px) {
    #projectionsChart .plotly-projection-div { height: 460px !important; }
  }
</style>

    <!-- MEMBER CAROUSEL -->
    <style>
      .member-activities-section { margin-top: 3rem; padding: 2rem 0; background-color: #f8f9fa; }
      .member-activities-carousel { position: relative; max-width: 1000px; margin: 0 auto; overflow: hidden; border-radius: 12px; }
      .member-activities-carousel .slides { display: flex; transition: transform 0.5s ease-in-out; height: 400px; }
      .member-activities-carousel .slide { min-width: 100%; height: 400px; flex-shrink: 0; }
      .member-activities-carousel .slide img { width: 100%; height: 100%; object-fit: cover; }
      .member-activities-carousel .nav-btn { position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; font-size: 18px; z-index: 10; }
      .member-activities-carousel .prev { left: 10px; }
      .member-activities-carousel .next { right: 10px; }
      .member-activities-carousel .dots { display: flex; justify-content: center; gap: 8px; margin-top: 1rem; }
      .member-activities-carousel .dot { width: 10px; height: 10px; border-radius: 50%; background: #ccc; cursor: pointer; }
      .member-activities-carousel .dot.active { background: #10B981; }
      @media (max-width: 768px) {
        .member-activities-carousel .slides, .member-activities-carousel .slide { height: 250px; }
      }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
    <div class="navbar">
        <a href="index.html"><img class="brand-logo round" src="./assets/141dd3faa98da9737b591161deac509a.jpg" alt="Soyosoyo Sacco Logo"></a>
        <a href="https://chamasoft.com/login" class="member-portal">Member Portal</a>
        <button id="menu-toggle" aria-label="Toggle Menu"><span></span><span></span><span></span></button>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="Products.html">Products</a>
            <a href="Online-Forms.html">Online Forms</a>
            <a href="Jobs.html">Jobs</a>
            <a href="About.html">About</a>
            <a href="Join-Us.html">Join Us</a>
        </nav>
    </div>
    <div class="hero">
        <div class="banner-text">
            <h1>Soyosoyo SACCO</h1>
            <p>Empowering Coastal Kenya with 1% Loans & High Dividends</p>
        </div>
    </div>
</header>

<!-- MAIN -->
<main class="container">
    <!-- HISTORY TEASER -->
    <section class="section">
        <h2 style="text-align: center; font-size: 1.6rem; margin-bottom: 1rem;">Our Journey</h2>
        <p style="text-align: center; max-width: 700px; margin: 0 auto 1.5rem;">
            Founded in 1998 as a medical aid cooperative, we’ve evolved into a trusted financial partner for many in the Kenyan Coast.
        </p>
        <div style="text-align: center;">
            <a href="About.html" class="products-button" style="display: inline-block; padding: 0.75rem 2rem;">Read Full History</a>
        </div>
    </section>

    <!-- MISSION / VISION / CORE VALUES -->
    <div class="mission-vision-container">
        <img src="./assets/0065564ad0f92baf9be886b031073979.jpg" alt="Mission" class="round">
        <div><h2>Our Mission</h2><p>Empower members with accessible, affordable credit for healthcare, education, agriculture, growth and development.</p></div>
    </div>
    <div class="mission-vision-container">
        <img src="./assets/d8c3d49708ed9831ff753b3548c717aa.jpg" alt="Vision" class="round">
        <div><h2>Our Vision</h2><p>To lead financial transformation and sustainable prosperity across Kenya.</p></div>
    </div>
    <div class="core-values-container">
        <img src="./assets/8119c4ebd64ccbe641d0563d23444c34.jpg" alt="Core Values" class="round">
        <div><h2>Core Values</h2><ul><li>Empowerment</li><li>Integrity</li><li>Community</li><li>Accessibility</li><li>Growth</li></ul></div>
    </div>

    <!-- LEADERSHIP -->
    <section class="section">
        <h2 style="text-align: center;">Leadership</h2>
        <div class="leadership-grid">
            <div class="leader-profile"><img src="./assets/judi.jpg" alt="Judith" class="round"><h3>Judith Malombo Mramba</h3><p>Chairperson</p></div>
            <div class="leader-profile"><img src="./assets/jere.jpg" alt="Jeremiah" class="round"><h3>Jeremiah Kalama Lewa</h3><p>Vice-Chairperson</p></div>
            <div class="leader-profile"><img src="./assets/sidi.jpg" alt="Sidi" class="round"><h3>Sidi Saro Ngowa</h3><p>Secretary</p></div>
            <div class="leader-profile"><img src="./assets/thoya.jpg" alt="Thomas" class="round"><h3>Thomas Thoya Kitsao</h3><p>Treasurer</p></div>
        </div>
    </section>

    <!-- PRODUCTS PREVIEW -->
    <section class="section">
        <h2 style="text-align: center;">Featured Product</h2>
        <div class="products-grid">
            <div class="product-card">
                <img src="./assets/ba04cd4377b3746fc0750dcf2ff3d935.jpg" alt="Education Loan" class="round">
                <h2 style="text-align: center;">Education Loan</h2>
                <p>Cover tuition, books, and living costs. Up to 12 months at 4% per annum.</p>
                <a href="Products.html" class="products-button">Explore All Products</a>
            </div>
        </div>
    </section>

<!-- ========================================
     1. FINANCIAL HIGHLIGHTS CAROUSEL
     ======================================== -->
<section class="section">
  <h2 style="text-align: center; margin-bottom: 1rem;">Financial Highlights</h2>
  <p style="text-align: center; margin-bottom: 1.5rem; color: #4b5563;">Our impact in numbers — updated daily.</p>
  <div class="carousel-wrapper">
    <div class="carousel" aria-label="Financial Metrics Carousel"></div>
  </div>
</section>

<!-- ========================================
     2. GROWTH SINCE JANUARY 2025 (PLOTLY)
     ======================================== -->
<section class="section" id="final-charts-section">
  <h2 style="text-align: center; margin-bottom: 1.5rem;">Growth Since January 2025</h2>
  <div class="growth-charts-grid">
    <div class="chart-card">
      <div id="plotMembers" class="plot-container"></div>
      <p>Total Members</p>
      <div id="growthMembers" class="growth-indicator"></div>
    </div>
    <div class="chart-card">
      <div id="plotLoans" class="plot-container"></div>
      <p>Loans Disbursed</p>
      <div id="growthLoans" class="growth-indicator"></div>
    </div>
    <div class="chart-card">
      <div id="plotLoanTypes" class="plot-container"></div>
      <p>Loan Types Distribution (%)</p>
    </div>
    <div class="chart-card">
      <div id="plotContributions" class="plot-container"></div>
      <p>Contributions</p>
      <div id="growthContributions" class="growth-indicator"></div>
    </div>
    <div class="chart-card">
      <div id="plotProfit" class="plot-container"></div>
      <p>Profit</p>
      <div id="growthProfit" class="growth-indicator"></div>
    </div>
    <div class="chart-card">
      <div id="plotROA" class="plot-container"></div>
      <p>Return on Assets (ROA)</p>
      <div id="growthROA" class="growth-indicator"></div>
    </div>
    <div class="chart-card">
      <div id="plotLiquidity" class="plot-container"></div>
      <p>Liquidity Ratio</p>
      <div id="growthLiquidity" class="growth-indicator"></div>
    </div>
  </div>
</section>

<!-- ========================================
     3. 5-YEAR GROWTH PROJECTIONS
     ======================================== -->
<section style="margin: 60px 0; padding: 0 10px;">
  <div style="text-align:center; margin-bottom: 30px;">
    <h2 style="font-size: 28px; color: #004d1a; font-weight: 900;">5-Year Growth Projections</h2>
    <p style="color: #6b7280; font-size: 16px;">Smart forecasting based on our current performance trajectory</p>
  </div>
  <div id="projectionsChart"></div>
</section>
    
     <!-- Loan Calculator Tool -->
    <section class="section tool-section" id="loan-calculator">
        <h2 style="text-align: center;">Loan Calculator</h2>
        <div class="calculator-wrapper">
            <div class="calculator">
                <h2><span class="soyo-logo">SOYOSOYO</span> SACCO Loan Calculator</h2>
                <div class="form-group">
                    <label for="loanType">Loan Type:</label>
                    <select id="loanType" onchange="updateFields()">
                        <option value="">Select Loan Type</option>
                        <option value="emergency">Emergency Loan</option>
                        <option value="medicare">Medicare Loan</option>
                        <option value="education">Education Loan</option>
                        <option value="development">Development Loan</option>
                        <option value="apiCulture">Api Culture Loan</option>
                    </select>
                </div>
                <div class="form-group interest-rate">
                    <label for="rate">Annual Interest Rate (%):</label>
                    <input type="text" id="rate" readonly placeholder="Select a loan type">
                </div>
                <div class="form-group tenure">
                    <label for="tenure">Tenure (Months):</label>
                    <input type="text" id="tenure" readonly placeholder="Select a loan type">
                </div>
                <div class="form-group">
                    <label for="principalAmount">Loan Amount (KES):</label>
                    <input type="number" id="principalAmount" min="0" max="1000000" step="0.01" value="10000" placeholder="e.g., 1250.50">
                </div>
                <button onclick="calculateLoan()">Calculate Loan</button>
                <div class="result" id="result"></div>

                <button onclick="toggleAmortizationTable()" id="amortizationButton" style="display: none;">View Amortization Table</button>
                <div class="amortization-table" id="amortizationTable" style="display: none;">
                    <table>
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Payment (KES)</th>
                                <th>Principal (KES)</th>
                                <th>Interest (KES)</th>
                                <th>Balance (KES)</th>
                            </tr>
                        </thead>
                        <tbody id="amortizationBody"></tbody>
                    </table>
                </div>

                <button onclick="showFinesSection()" id="finesPromptButton" style="display: none;">Calculate Fines for Missed Payments</button>
                <button onclick="toggleChart()" id="chartButton" style="display: none;">View Chart</button>
                <div class="loan-chart" id="loanChart" style="display: none;"></div>

                <div class="fines-section" id="finesSection" style="display: none;">
                    <h3>Calculate Late Repayment Fines</h3>
                    <div class="form-group">
                        <label for="lateMonth">Month of First Missed Payment:</label>
                        <input type="number" id="lateMonth" placeholder="e.g., 1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="monthsLate">Number of Consecutive Missed Payments:</label>
                        <input type="number" id="monthsLate" placeholder="e.g., 3" min="0">
                    </div>
                    <div class="form-group" id="paymentGroup" style="display: none;">
                        <label for="paymentMonth">Month to Add Payment:</label>
                        <input type="number" id="paymentMonth" placeholder="e.g., 4" min="1">
                        <label for="paymentAmount">Amount Paid (KES):</label>
                        <input type="number" id="paymentAmount" placeholder="e.g., 500" min="0">
                        <button onclick="addPayment()">Add Payment</button>
                    </div>
                    <button onclick="calculateFines()">Calculate Fines</button>
                    <div class="result" id="finesResult"></div>
                    <button onclick="toggleFinesAmortizationTable()" id="finesAmortizationButton" style="display: none;">View Amortization Table with Fines</button>
                    <div class="fines-amortization-table" id="finesAmortizationTable" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Payment (KES)</th>
                                    <th>Principal (KES)</th>
                                    <th>Interest (KES)</th>
                                    <th>Installment Fine (KES)</th>
                                    <th>Outstanding Fine (KES)</th>
                                    <th>Balance (KES)</th>
                                </tr>
                            </thead>
                            <tbody id="finesAmortizationBody"></tbody>
                        </table>
                    </div>
                </div>

                <noscript><div class="error-message">JavaScript is disabled. Please enable JavaScript to use the loan calculator.</div></noscript>
            </div>
        </div>
    </section>


    <!-- DIVIDENDS CALCULATOR -->
    <section class="tool-section" id="dividends-calculator">
        <h2 style="text-align: center;">Dividends Calculator</h2>
        <div class="calculator">
            <div class="form-group">
                <label for="dividendRate">Dividend Rate (%):</label>
                <input type="number" id="dividendRate" placeholder="e.g., 12.5" step="0.01">
            </div>
            <div class="month-subheader">Enter your monthly savings contributions in the spaces below:</div>
            <div class="month-inputs">
                <input type="number" id="jan" placeholder="Jan" min="0" step="0.01">
                <input type="number" id="feb" placeholder="Feb" min="0" step="0.01">
                <input type="number" id="mar" placeholder="Mar" min="0" step="0.01">
                <input type="number" id="apr" placeholder="Apr" min="0" step="0.01">
                <input type="number" id="may" placeholder="May" min="0" step="0.01">
                <input type="number" id="jun" placeholder="Jun" min="0" step="0.01">
                <input type="number" id="jul" placeholder="Jul" min="0" step="0.01">
                <input type="number" id="aug" placeholder="Aug" min="0" step="0.01">
                <input type="number" id="sep" placeholder="Sep" min="0" step="0.01">
                <input type="number" id="oct" placeholder="Oct" min="0" step="0.01">
                <input type="number" id="nov" placeholder="Nov" min="0" step="0.01">
                <input type="number" id="dec" placeholder="Dec" min="0" step="0.01">
            </div>
            <button onclick="calculateDividend()">Calculate Dividend</button>
            <div class="result" id="dividendResult"></div>
        </div>
    </section>

    <!-- MEMBER ACTIVITIES CAROUSEL -->
    <section class="member-activities-section">
        <h2 style="text-align: center;">Member Activities</h2>
        <p style="text-align: center; margin-bottom: 1.5rem;">See what our members are up to.</p>
        <div class="member-activities-carousel">
            <div class="slides" id="memberSlides"></div>
            <button class="nav-btn prev" onclick="changeSlide(-1)">Previous</button>
            <button class="nav-btn next" onclick="changeSlide(1)">Next</button>
            <div class="dots" id="memberDots"></div>
        </div>
    </section>

</main>

<!-- FOOTER -->
<footer>
    <p>© <span id="autoYearStart">2025</span>–<span id="autoYearNow"></span>  SOYOSOYO SACCO. All rights reserved. | <a href="mailto:info@soyosoyosacco.com">info@soyosoyosacco.com</a></p>
    <div class="social-icons">
        <a href="https://www.facebook.com/people/Soyosoyo-Sacco/61565783836766/" target="_blank" aria-label="Facebook">Facebook</a>
        <a href="https://x.com/SoyosoyoSACCO" target="_blank" aria-label="Twitter">Twitter</a>
        <a href="https://www.instagram.com/soyosoyosacco" target="_blank" aria-label="Instagram">Instagram</a>
    </div>
</footer>

<!-- SCRIPTS -->
<script>
  document.getElementById('autoYearNow').textContent = new Date().getFullYear();
</script>
    
<!-- Initialize Calculator -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof updateFields === 'function') updateFields();
        if (typeof updateSliderValue === 'function') updateSliderValue('principal');
    });
</script>

<!-- SCRIPTS - EXACT ORDER, NO CONFLICTS -->
<script src="./scripts/carousel.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="./scripts/projections.js"></script>
<script src="./scripts/member-carousel.js"></script>
    <script src="./scripts/calculator.js"></script>
    <script src="./scripts/dividendscalculator.js"></script>
    <script src="./scripts/chatbot.js"></script>

<script>
// PLOTLY GROWTH CHARTS — FINAL VERSION: FULL NEGATIVE RED SUPPORT + ZERO DOM WATCHERS (Nov 19, 2025)
function renderPlotlyGrowthCharts() {
  const data = window.saccoData;
  if (!data || !data.jan || !data.today) {
    console.warn('growth-charts: Waiting for saccoData...');
    return false;
  }

  const { jan, today } = data;

  // Correct Total Assets (used for ROA)
  const janTotalAssets = (jan.loans || jan.loansBalance || 0) + (jan.bankBalance || jan.totalBankBalance || 0);
  const todayTotalAssets = (today.loansBalance || 0) + (today.totalBankBalance || today.bankBalance || 0);

  // ROA & Liquidity
  const janROA   = janTotalAssets   > 0 ? (jan.profit   / janTotalAssets)   * 100 : 0;
  const todayROA = todayTotalAssets > 0 ? (today.profit / todayTotalAssets) * 100 : 0;
  const janLiq   = jan.contributions > 0 ? ((jan.bankBalance || 0) / jan.contributions) * 100 : 0;
  const todayLiq = today.contributions > 0 ? ((today.bankBalance || 0) / today.contributions) * 100 : 0;

  const fmt = (n) => n.toLocaleString('en-KE');
  const growth = (now, then) => {
    if (then === 0) return now === 0 ? 0 : 100;
    return ((now - then) / Math.abs(then)) * 100;
  };

  const baseLayout = {
    margin: { t: 80, b: 60, l: 50, r: 40 },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: { family: 'Lato, sans-serif', color: '#1a1a1a' },
    showlegend: false,
    bargap: 0.5,
    xaxis: { fixedrange: true, tickfont: { size: 13 } },
    yaxis: { fixedrange: true, gridcolor: '#e5e7eb', zerolinecolor: '#999', zerolinewidth: 1.5, tickformat: ',.0f' }
  };

  const config = { responsive: true, displayModeBar: false };

  const createBarWithArrow = (id, janVal, todayVal, colorJan, colorToday, isPct = false, isMoney = false, gid) => {
    const g = growth(todayVal, janVal);
    const rawDiff = todayVal - janVal;
    const isImprovement = rawDiff > 0 || (janVal < 0 && todayVal >= 0) || (janVal < 0 && todayVal < janVal && Math.abs(todayVal) < Math.abs(janVal));

    // Update small text indicator below chart
    const el = document.getElementById(gid);
    if (el) {
      el.innerHTML = `<i class="fas fa-arrow-${isImprovement ? 'up' : 'down'}"></i> ${g >= 0 ? '+' : ''}${g.toFixed(1)}%`;
      el.className = `growth-indicator ${isImprovement ? 'positive' : 'negative'}`;
    }

    const displayJan = isPct ? janVal.toFixed(2) + '%' : isMoney ? 'KES ' + fmt(janVal) : fmt(janVal);
    const displayToday = isPct ? todayVal.toFixed(2) + '%' : isMoney ? 'KES ' + fmt(todayVal) : fmt(todayVal);

    // Dynamic Y range (handles negatives)
    const values = [janVal, todayVal];
    const absMax = Math.max(Math.abs(janVal), Math.abs(todayVal));
    const padding = absMax * 0.5;
    const yMin = Math.min(...values) - padding;
    const yMax = Math.max(...values) + padding;

    const trace = {
      x: ['Jan 2025', 'Today'],
      y: values,
      type: 'bar',
      marker: {
        color: [
          janVal < 0 ? '#ef4444' : colorJan,
          todayVal < 0 ? '#ef4444' : colorToday
        ]
      },
      text: [displayJan, displayToday],
      textposition: 'outside',
      cliponaxis: false,
      textfont: {
        color: [                      // THIS IS THE KEY — FORCED RED FOR NEGATIVE BARS
          janVal < 0 ? '#991b1b' : '#004d1a',
          todayVal < 0 ? '#991b1b' : '#004d1a'
        ],
        size: 16,
        family: 'Lato, sans-serif',
        weight: 'bold'
      }
    };

    const layout = {
      ...baseLayout,
      yaxis: { ...baseLayout.yaxis, range: [yMin, yMax], zeroline: true },
      shapes: [],
      annotations: []
    };

    // Big percentage + short dash at the top — now 100% red when negative
    if (Math.abs(g) > 0.1) {
      const midX = 0.5;
      const topY = Math.max(...values) + padding * 0.8;

      // Short horizontal dash
      layout.shapes.push({
        type: 'line',
        x0: midX - 0.15, y0: topY - 30,
        x1: midX + 0.15, y1: topY - 30,
        line: { color: isImprovement ? '#10B981' : '#EF4444', width: 8 },
        layer: 'above'
      });

      // Big percentage label
      layout.annotations.push({
        x: midX,
        y: topY,
        yref: 'y',
        text: `<b>${g >= 0 ? '+' : ''}${g.toFixed(1)}%</b>`,
        showarrow: false,
        font: { size: 26, family: 'Lato, sans-serif', color: isImprovement ? '#10B981' : '#EF4444' },
        bgcolor: 'rgba(255,255,255,0.97)',
        bordercolor: isImprovement ? '#10B981' : '#EF4444',
        borderwidth: 4,
        borderpad: 12,
        borderradius: 14,
        yshift: 10
      });
    }

    Plotly.newPlot(id, [trace], layout, config);
  };

  // Render all charts
  createBarWithArrow('plotMembers', jan.members, today.members, '#8B5CF6', '#C4B5FD', false, false, 'growthMembers');
  createBarWithArrow('plotLoans', jan.loans || 0, today.loans || 0, '#F59E0B', '#FBBF24', false, true, 'growthLoans');
  createBarWithArrow('plotContributions', jan.contributions, today.contributions, '#10B981', '#34D399', false, true, 'growthContributions');
  createBarWithArrow('plotProfit', jan.profit, today.profit, '#EF4444', '#F87171', false, true, 'growthProfit');
  createBarWithArrow('plotROA', janROA, todayROA, '#0EA5E9', '#7DD3FC', true, false, 'growthROA');
  createBarWithArrow('plotLiquidity', janLiq, todayLiq, '#6366F1', '#A5B4FC', true, false, 'growthLiquidity');

  // Loan Types Pie Chart + Expected Yield (unchanged)
  if (window.loanTypesToday?.length > 0) {
    const loanTypes = window.loanTypesToday.filter(t => t.value > 0);
    const total = loanTypes.reduce((s, t) => s + t.value, 0);

    const yieldPct = loanTypes.reduce((sum, t) => {
      let rate = 0;
      if (t.name.toLowerCase().includes('development')) rate = 12;
      else if (t.name.toLowerCase().includes('emergency')) rate = 36;
      else if (t.name.toLowerCase().includes('medicare') || t.name.toLowerCase().includes('education')) rate = 4;
      return sum + rate * (t.value / total);
    }, 0);

    let yieldEl = document.getElementById('projectedYield');
    if (!yieldEl) {
      yieldEl = document.createElement('div');
      yieldEl.id = 'projectedYield';
      document.querySelector('#plotLoanTypes').parentElement.appendChild(yieldEl);
    }
    yieldEl.textContent = `${yieldPct.toFixed(1)}% p.a. expected yield`;

    Plotly.newPlot('plotLoanTypes', [{
      values: loanTypes.map(t => t.value),
      labels: loanTypes.map(t => t.name),
      type: 'pie',
      textinfo: 'percent',
      textposition: 'inside',
      automargin: true,
      marker: { colors: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'] },
      hovertemplate: '<b>%{label}</b><br>%{percent}<br>KES %{value:,.0f}<extra></extra>'
    }], {
      margin: { t: 30, b: 30, l: 10, r: 10 },
      paper_bgcolor: 'rgba(0,0,0,0)',
      font: { family: 'Lato, sans-serif' }
    }, config);
  }

  console.log('SOYOSOYO: All growth charts rendered — NEGATIVE VALUES NOW 100% RED & MOBILE-SAFE');
  return true;
}

// Safe render loop — still no DOM listeners that break mobile menu
document.addEventListener('DOMContentLoaded', () => {
  const tryRender = () => {
    if (!renderPlotlyGrowthCharts()) setTimeout(tryRender, 300);
  };
  window.addEventListener('saccoDataUpdated', () => setTimeout(tryRender, 100));
  tryRender();
});
</script>

<!-- MAIN MENU — LOAD LAST -->
<script defer src="./scripts/main.js"></script>

</body>
</html>
