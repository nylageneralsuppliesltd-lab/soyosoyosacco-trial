<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msvalidate.01" content="858002EEAD3486E0F9BDC0652A4071B4" />
    <title>Soyosoyo SACCO | Affordable Loans & Savings in Coastal Kenya</title>
    <meta name="description" content="Join Soyosoyo SACCO for 1% monthly loans, high dividends, and financial empowerment. Emergency, education, and development loans available in Mombasa, Kilifi, Kwale.">
    <meta name="keywords" content="SACCO Kenya, loans Mombasa, savings cooperative, emergency loan, education loan, Soyosoyo SACCO">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Soyosoyo SACCO | Affordable Loans & Savings in Coastal Kenya">
    <meta property="og:description" content="Join Soyosoyo SACCO for 1% monthly loans, high dividends, and financial empowerment.">
    <meta property="og:image" content="https://soyosoyosacco.com/assets/141dd3faa98da9737b591161deac509a.jpg">
    <meta property="og:url" content="https://soyosoyosacco.com/">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Soyosoyo SACCO | Affordable Loans & Savings">
    <meta name="twitter:description" content="1% monthly loans in Coastal Kenya. Join with KSh 200!">
    <meta name="twitter:image" content="https://soyosoyosacco.com/assets/141dd3faa98da9737b591161deac509a.jpg">
    <link rel="canonical" href="https://soyosoyosacco.com/">
    <link rel="icon" href="./assets/141dd3faa98da9737b591161deac509a.jpg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="./style.css?v=207">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-05M38MYK0G"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-05M38MYK0G');
    </script>

    <!-- PERFECT CHARTS + PROJECTIONS STYLES -->
    <style id="final-working-styles">
      .growth-charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
      }
      #final-charts-section .chart-card {
        position: relative;
        height: 440px;
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        overflow: hidden;
        border: 1px solid #f0f0f0;
      }
      #final-charts-section .chart-card canvas {
        flex: 1;
        width: 100% !important;
        height: 100% !important;
        min-height: 320px;
        display: block;
      }
      #final-charts-section .chart-card p {
        margin: 0.75rem 0 0 0;
        text-align: center;
        font-weight: bold;
        color: #1a1a1a;
        font-size: 1rem;
      }
      #final-charts-section .growth-indicator {
        text-align: center;
        margin-top: 0.5rem;
        font-weight: bold;
        font-size: 1rem;
      }
      #final-charts-section .growth-indicator.positive { color: #10B981; }
      #final-charts-section .growth-indicator.negative { color: #EF4444; }
      #final-charts-section .growth-indicator i { margin-right: 4px; font-size: 0.9em; }
      @media (max-width: 768px) {
        #final-charts-section .chart-card { height: 400px; }
        #final-charts-section .chart-card canvas { min-height: 280px; }
      }
      /* === PLOTLY PROJECTIONS === */
      #projectionsChart {
        isolation: isolate;
        contain: layout style paint;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 10px;
        font-family: 'Lato', sans-serif;
      }
      #projectionsChart > .kpi-card,
      #projectionsChart > .summary-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #f0fdf4;
        margin: 16px 8px;
        max-width: calc(100% - 16px);
      }
      #projectionsChart .kpi-title {
        padding: 16px;
        background: #f8fdfa;
        text-align: center;
        font-size: 16px;
        font-weight: 900;
        color: #004d1a;
      }
      #projectionsChart .plotly-projection-div {
        height: 420px !important;
        width: 100% !important;
      }
      #projectionsChart .summary-header {
        background: linear-gradient(90deg,#004d1a,#10B981);
        color: white;
        padding: 16px;
        text-align: center;
        font-size: 17px;
        font-weight: 900;
      }
      #projectionsChart .summary-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 14px;
        padding: 16px;
      }
      #projectionsChart .summary-item {
        background: #f0fdf4;
        border-radius: 14px;
        padding: 12px;
        border: 1px solid #86efac;
        text-align: center;
      }
      #projectionsChart .summary-label {
        font-size: 13.5px;
        font-weight: 900;
        color: #166534;
      }
      #projectionsChart .summary-values {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        margin: 8px 0;
      }
      #projectionsChart .summary-values span {
        color: #6b7280;
        font-size: 11.5px;
        display: block;
      }
      #projectionsChart .summary-values strong {
        font-size: 15px;
        color: #004d1a;
      }
      #projectionsChart .summary-growth {
        background: #10B981;
        color: white;
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 12.5px;
        font-weight: 900;
      }
      @media (min-width: 769px) {
        #projectionsChart { display: flex; flex-wrap: wrap; justify-content: space-between; }
        #projectionsChart > .kpi-card { flex: 1 1 calc(50% - 20px); max-width: 48%; }
        #projectionsChart .plotly-projection-div { height: 440px !important; }
        #projectionsChart > .summary-card { flex: 1 1 100%; max-width: 100%; margin: 30px 8px 10px; }
        #projectionsChart .summary-grid { grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 20px; }
        #projectionsChart .summary-values strong { font-size: 17px; }
        #projectionsChart .summary-growth { padding: 8px 16px; font-size: 13px; }
      }
      @media (max-width: 768px) {
        #projectionsChart .plotly-projection-div { height: 460px !important; }
      }
    </style>

    <!-- MEMBER CAROUSEL -->
    <style>
      .member-activities-section { margin-top: 3rem; padding: 2rem 0; background-color: #f8f9fa; }
      .member-activities-carousel { position: relative; max-width: 1000px; margin: 0 auto; overflow: hidden; border-radius: 12px; }
      .member-activities-carousel .slides { display: flex; transition: transform 0.5s ease-in-out; height: 400px; }
      .member-activities-carousel .slide { min-width: 100%; height: 400px; flex-shrink: 0; }
      .member-activities-carousel .slide img { width: 100%; height: 100%; object-fit: cover; }
      .member-activities-carousel .nav-btn { position: absolute; top: 50%; transform: translateY(-50%);
        background: rgba(0,0,0,0.5); color: white; border: none; padding: 10px; cursor: pointer; font-size: 18px; z-index: 10; }
      .member-activities-carousel .prev { left: 10px; }
      .member-activities-carousel .next { right: 10px; }
      .member-activities-carousel .dots { display: flex; justify-content: center; gap: 8px; margin-top: 1rem; }
      .member-activities-carousel .dot { width: 10px; height: 10px; border-radius: 50%; background: #ccc; cursor: pointer; }
      .member-activities-carousel .dot.active { background: #10B981; }
      @media (max-width: 768px) {
        .member-activities-carousel .slides, .member-activities-carousel .slide { height: 250px; }
      }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
    <div class="navbar">
        <a href="index.html"><img class="brand-logo round" src="./assets/141dd3faa98da9737b591161deac509a.jpg" alt="Soyosoyo Sacco Logo"></a>
        <a href="https://chamasoft.com/login" class="member-portal">Member Portal</a>
        <button id="menu-toggle" aria-label="Toggle Menu"><span></span><span></span><span></span></button>
        <nav class="nav-links">
            <a href="index.html">Home</a>
            <a href="Products.html">Products</a>
            <a href="Online-Forms.html">Online Forms</a>
            <a href="Jobs.html">Jobs</a>
            <a href="About.html">About</a>
            <a href="Join-Us.html">Join Us</a>
        </nav>
    </div>
    <div class="hero">
        <div class="banner-text">
            <h1>Soyosoyo SACCO</h1>
            <p>Empowering Coastal Kenya with 1% Loans & High Dividends</p>
        </div>
    </div>
</header>

<!-- MAIN -->
<main class="container">
    <!-- HISTORY TEASER -->
    <section class="section">
        <h2 style="text-align: center; font-size: 1.6rem; margin-bottom: 1rem;">Our Journey</h2>
        <p style="text-align: center; max-width: 700px; margin: 0 auto 1.5rem;">
            Founded in 1998 as a medical aid cooperative, we’ve evolved into a trusted financial partner for many in the Kenyan Coast.
        </p>
        <div style="text-align: center;">
            <a href="About.html" class="products-button" style="display: inline-block; padding: 0.75rem 2rem;">Read Full History</a>
        </div>
    </section>

    <!-- MISSION / VISION / CORE VALUES -->
    <div class="mission-vision-container">
        <img src="./assets/0065564ad0f92baf9be886b031073979.jpg" alt="Mission" class="round">
        <div><h2>Our Mission</h2><p>Empower members with accessible, affordable credit for healthcare, education, agriculture, growth and development.</p></div>
    </div>
    <div class="mission-vision-container">
        <img src="./assets/d8c3d49708ed9831ff753b3548c717aa.jpg" alt="Vision" class="round">
        <div><h2>Our Vision</h2><p>To lead financial transformation and sustainable prosperity across Kenya.</p></div>
    </div>
    <div class="core-values-container">
        <img src="./assets/8119c4ebd64ccbe641d0563d23444c34.jpg" alt="Core Values" class="round">
        <div><h2>Core Values</h2><ul><li>Empowerment</li><li>Integrity</li><li>Community</li><li>Accessibility</li><li>Growth</li></ul></div>
    </div>

    <!-- LEADERSHIP -->
    <section class="section">
        <h2 style="text-align: center;">Leadership</h2>
        <div class="leadership-grid">
            <div class="leader-profile"><img src="./assets/judi.jpg" alt="Judith" class="round"><h3>Judith Malombo Mramba</h3><p>Chairperson</p></div>
            <div class="leader-profile"><img src="./assets/jere.jpg" alt="Jeremiah" class="round"><h3>Jeremiah Kalama Lewa</h3><p>Vice-Chairperson</p></div>
            <div class="leader-profile"><img src="./assets/sidi.jpg" alt="Sidi" class="round"><h3>Sidi Saro Ngowa</h3><p>Secretary</p></div>
            <div class="leader-profile"><img src="./assets/thoya.jpg" alt="Thomas" class="round"><h3>Thomas Thoya Kitsao</h3><p>Treasurer</p></div>
        </div>
    </section>

    <!-- PRODUCTS PREVIEW -->
    <section class="section">
        <h2 style="text-align: center;">Featured Product</h2>
        <div class="products-grid">
            <div class="product-card">
                <img src="./assets/ba04cd4377b3746fc0750dcf2ff3d935.jpg" alt="Education Loan" class="round">
                <h2 style="text-align: center;">Education Loan</h2>
                <p>Cover tuition, books, and living costs. Up to 12 months at 4% per annum.</p>
                <a href="Products.html" class="products-button">Explore All Products</a>
            </div>
        </div>
    </section>

    <!-- FINANCIAL HIGHLIGHTS CAROUSEL -->
    <section class="section">
        <h2 style="text-align: center;">Financial Highlights</h2>
        <p style="text-align: center; margin-bottom: 1.5rem;">Our impact in numbers.</p>
        <div class="carousel-wrapper"><div class="carousel" aria-label="Financial Metrics Carousel"></div></div>
    </section>

    <!-- GROWTH CHARTS -->
    <section class="section" id="final-charts-section">
        <h2 style="text-align: center; margin-bottom: 1.5rem;">Growth Since January 2025</h2>
        <div class="growth-charts-grid">
            <div class="chart-card"><canvas id="chartMembers"></canvas><p>Total Members</p><div id="growthMembers" class="growth-indicator"></div></div>
            <div class="chart-card"><canvas id="chartLoans"></canvas><p>Loans Disbursed</p><div id="growthLoans" class="growth-indicator"></div></div>
            <div class="chart-card"><canvas id="chartLoanTypes"></canvas><p>Loan Types Distribution (%)</p></div>
            <div class="chart-card"><canvas id="chartContributions"></canvas><p>Contributions</p><div id="growthContributions" class="growth-indicator"></div></div>
            <div class="chart-card"><canvas id="chartProfit"></canvas><p>Profit</p><div id="growthProfit" class="growth-indicator"></div></div>
            <div class="chart-card"><canvas id="chartROA"></canvas><p>Return on Assets (ROA)</p><div id="growthROA" class="growth-indicator"></div></div>
            <div class="chart-card"><canvas id="chartLiquidity"></canvas><p>Liquidity Ratio</p><div id="growthLiquidity" class="growth-indicator"></div></div>
        </div>
    </section>

    <!-- PROJECTIONS -->
    <section style="margin: 60px 0; padding: 0 10px;">
        <div style="text-align:center; margin-bottom: 30px;">
            <h2 style="font-size: 28px; color: #004d1a; font-weight: 900;">5-Year Growth Projections</h2>
            <p style="color: #6b7280; font-size: 16px;">Smart forecasting based on our current performance trajectory</p>
        </div>
        <div id="projectionsChart"></div>
    </section>

    <!-- LOAN CALCULATOR -->
    <section class="tool-section" id="loan-calculator">
        <h2 style="text-align: center;">Loan Calculator</h2>
        <div class="calculator-wrapper">
            <div class="calculator">
                <h2><span class="soyo-logo">SOYOSOYO</span> SACCO Loan Calculator</h2>
                <div class="form-group">
                    <label for="loanType">Loan Type:</label>
                    <select id="loanType" onchange="updateFields()">
                        <option value="">Select Loan Type</option>
                        <option value="emergency">Emergency Loan</option>
                        <option value="medicare">Medicare Loan</option>
                        <option value="education">Education Loan</option>
                        <option value="development">Development Loan</option>
                        <option value="apiCulture">Api Culture Loan</option>
                    </select>
                </div>
                <div class="form-group interest-rate">
                    <label for="rate">Annual Interest Rate (%):</label>
                    <input type="text" id="rate" readonly placeholder="Select a loan type">
                </div>
                <div class="form-group tenure">
                    <label for="tenure">Tenure (Months):</label>
                    <input type="text" id="tenure" readonly placeholder="Select a loan type">
                </div>
                <div class="form-group">
                    <label for="principalAmount">Loan Amount (KES):</label>
                    <input type="number" id="principalAmount" min="0" max="1000000" step="0.01" value="10000">
                </div>
                <button onclick="calculateLoan()">Calculate Loan</button>
                <div class="result" id="result"></div>

                <button onclick="toggleAmortizationTable()" id="amortizationButton" style="display: none; margin-top: 1rem;">View Amortization Table</button>
                <div class="amortization-table" id="amortizationTable" style="display: none; margin-top: 1rem;">
                    <table><thead><tr><th>Month</th><th>Payment (KES)</th><th>Principal (KES)</th><th>Interest (KES)</th><th>Balance (KES)</th></tr></thead><tbody id="amortizationBody"></tbody></table>
                </div>

                <button onclick="showFinesSection()" id="finesPromptButton" style="display: none; margin-top: 1rem;">Calculate Fines for Missed Payments</button>
                <div class="fines-section" id="finesSection" style="display: none; margin-top: 1rem;">
                    <h3>Calculate Late Repayment Fines</h3>
                    <div class="form-group">
                        <label for="lateMonth">Month of First Missed Payment:</label>
                        <input type="number" id="lateMonth" placeholder="e.g., 1" min="1">
                    </div>
                    <div class="form-group">
                        <label for="monthsLate">Number of Consecutive Missed Payments:</label>
                        <input type="number" id="monthsLate" placeholder="e.g., 3" min="0">
                    </div>
                    <div class="form-group" id="paymentGroup" style="display: none;">
                        <label for="paymentMonth">Month to Add Payment:</label>
                        <input type="number" id="paymentMonth" placeholder="e.g., 4" min="1">
                        <label for="paymentAmount">Amount Paid (KES):</label>
                        <input type="number" id="paymentAmount" placeholder="e.g., 500" min="0">
                        <button onclick="addPayment()">Add Payment</button>
                    </div>
                    <button onclick="calculateFines()">Calculate Fines</button>
                    <div class="result" id="finesResult"></div>
                    <button onclick="toggleFinesAmortizationTable()" id="finesAmortizationButton" style="display: none; margin-top: 1rem;">View Amortization Table with Fines</button>
                    <div class="fines-amortization-table" id="finesAmortizationTable" style="display: none; margin-top: 1rem;">
                        <table><thead><tr><th>Month</th><th>Payment (KES)</th><th>Principal (KES)</th><th>Interest (KES)</th><th>Installment Fine (KES)</th><th>Outstanding Fine (KES)</th><th>Balance (KES)</th></tr></thead><tbody id="finesAmortizationBody"></tbody></table>
                    </div>
                </div>

                <button onclick="toggleChart()" id="chartButton" style="display: none; margin-top: 1rem;">View Chart</button>
                <div class="loan-chart" id="loanChart" style="display: none; margin-top: 1rem; height: 300px;"></div>
            </div>
        </div>
    </section>

    <!-- DIVIDENDS CALCULATOR -->
    <section class="tool-section" id="dividends-calculator">
        <h2 style="text-align: center;">Dividends Calculator</h2>
        <div class="calculator">
            <div class="form-group">
                <label for="dividendRate">Dividend Rate (%):</label>
                <input type="number" id="dividendRate" placeholder="e.g., 12.5" step="0.01">
            </div>
            <div class="month-subheader">Enter your monthly savings contributions in the spaces below:</div>
            <div class="month-inputs">
                <input type="number" id="jan" placeholder="Jan" min="0" step="0.01">
                <input type="number" id="feb" placeholder="Feb" min="0" step="0.01">
                <input type="number" id="mar" placeholder="Mar" min="0" step="0.01">
                <input type="number" id="apr" placeholder="Apr" min="0" step="0.01">
                <input type="number" id="may" placeholder="May" min="0" step="0.01">
                <input type="number" id="jun" placeholder="Jun" min="0" step="0.01">
                <input type="number" id="jul" placeholder="Jul" min="0" step="0.01">
                <input type="number" id="aug" placeholder="Aug" min="0" step="0.01">
                <input type="number" id="sep" placeholder="Sep" min="0" step="0.01">
                <input type="number" id="oct" placeholder="Oct" min="0" step="0.01">
                <input type="number" id="nov" placeholder="Nov" min="0" step="0.01">
                <input type="number" id="dec" placeholder="Dec" min="0" step="0.01">
            </div>
            <button onclick="calculateDividend()">Calculate Dividend</button>
            <div class="result" id="dividendResult"></div>
        </div>
    </section>

    <!-- MEMBER ACTIVITIES CAROUSEL -->
    <section class="member-activities-section">
        <h2 style="text-align: center;">Member Activities</h2>
        <p style="text-align: center; margin-bottom: 1.5rem;">See what our members are up to.</p>
        <div class="member-activities-carousel">
            <div class="slides" id="memberSlides"></div>
            <button class="nav-btn prev" onclick="changeSlide(-1)">Previous</button>
            <button class="nav-btn next" onclick="changeSlide(1)">Next</button>
            <div class="dots" id="memberDots"></div>
        </div>
    </section>

</main>

<!-- FOOTER -->
<footer>
    <p>© <span id="autoYearStart">2025</span>–<span id="autoYearNow"></span>  SOYOSOYO SACCO. All rights reserved. | <a href="mailto:info@soyosoyosacco.com">info@soyosoyosacco.com</a></p>
    <div class="social-icons">
        <a href="https://www.facebook.com/people/Soyosoyo-Sacco/61565783836766/" target="_blank" aria-label="Facebook">Facebook</a>
        <a href="https://x.com/SoyosoyoSACCO" target="_blank" aria-label="Twitter">Twitter</a>
        <a href="https://www.instagram.com/soyosoyosacco" target="_blank" aria-label="Instagram">Instagram</a>
    </div>
</footer>

<!-- SCRIPTS -->
<script>
  document.getElementById('autoYearNow').textContent = new Date().getFullYear();
</script>

<!-- SCRIPTS - EXACT ORDER, NO CONFLICTS -->
<script src="./scripts/carousel.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="./scripts/projections.js"></script>
<script src="./scripts/member-carousel.js"></script>

<!-- FINAL BULLETPROOF CHARTS + ARROW PLUGIN (NO ERRORS) -->
<script>
  // Safely register plugins (wait for Chart.js to load)
  function registerPlugins() {
    if (typeof Chart !== 'undefined') {
      if (typeof ChartDataLabels !== 'undefined') {
        Chart.register(ChartDataLabels);
        console.log('ChartDataLabels registered – charts should now render with labels and arrows');
      }
      
      // Custom arrow plugin for growth indicators
      const finalGrowthArrowPlugin = {
        id: 'finalGrowthArrow',
        afterDraw: function(chart) {
          if (!chart || !chart.ctx || !chart.scales || !chart.data || !chart.data.datasets || chart.data.datasets.length === 0) return;
          
          const dataset = chart.data.datasets[0];
          if (!dataset || !dataset.data || dataset.data.length < 2) return;
          
          const janVal = dataset.data[0];
          const todayVal = dataset.data[1];
          if (janVal === undefined || todayVal === undefined) return;

          const growthPercent = janVal === 0 ? (todayVal === 0 ? 0 : 100) : ((todayVal - janVal) / Math.abs(janVal)) * 100;
          const isPositive = growthPercent >= 0;

          const xScale = chart.scales.x;
          const yScale = chart.scales.y;
          if (!xScale || !yScale) return;

          const x1 = xScale.getPixelForValue(0);
          const x2 = xScale.getPixelForValue(1);
          const y1 = yScale.getPixelForValue(janVal);
          const y2 = yScale.getPixelForValue(todayVal);

          if (!Number.isFinite(x1) || !Number.isFinite(x2) || !Number.isFinite(y1) || !Number.isFinite(y2)) return;

          const ctx = chart.ctx;
          ctx.save();
          ctx.strokeStyle = isPositive ? '#10B981' : '#EF4444';
          ctx.lineWidth = 5;
          ctx.lineCap = 'round';

          ctx.beginPath();
          ctx.moveTo(x1, y1);
          ctx.lineTo(x2, y2);
          ctx.stroke();

          const headLength = 18;
          const angle = Math.atan2(y2 - y1, x2 - x1);
          ctx.beginPath();
          ctx.moveTo(x2, y2);
          ctx.lineTo(x2 - headLength * Math.cos(angle - Math.PI / 6), y2 - headLength * Math.sin(angle - Math.PI / 6));
          ctx.lineTo(x2 - headLength * Math.cos(angle + Math.PI / 6), y2 - headLength * Math.sin(angle + Math.PI / 6));
          ctx.closePath();
          ctx.fillStyle = isPositive ? '#10B981' : '#EF4444';
          ctx.fill();

          if (Math.abs(growthPercent) > 0.1) {
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2 - 25;
            ctx.font = 'bold 16px Lato';
            ctx.fillStyle = isPositive ? '#10B981' : '#EF4444';
            ctx.textAlign = 'center';
            ctx.fillText(`${isPositive ? '+' : ''}${growthPercent.toFixed(1)}%`, midX, midY);
          }

          ctx.restore();
        }
      };
      Chart.register(finalGrowthArrowPlugin);
    }
  }

  // Loan types data (global)
  window.loanTypes = [
    { name: "Emergency", value: 38 },
    { name: "Education", value: 25 },
    { name: "Development", value: 20 },
    { name: "Medicare", value: 12 },
    { name: "Api Culture", value: 5 }
  ];

  // Render charts function (unchanged logic, but with safeguards)
  function renderGrowthCharts() {
    if (window.growthChartsRendered) return;
    window.growthChartsRendered = true;

    // Destroy existing charts to avoid overlaps
    document.querySelectorAll('#final-charts-section canvas').forEach(canvas => {
      if (Chart.getChart(canvas)) Chart.getChart(canvas).destroy();
    });

    if (!window.saccoData) {
      console.warn('saccoData not loaded yet—retrying in 500ms');
      setTimeout(renderGrowthCharts, 500);
      return;
    }

    const { jan, today } = window.saccoData;
    const colors = {
      members: { jan: '#8B5CF6', today: '#C4B5FD' },
      loans: { jan: '#F59E0B', today: '#FBBF24' },
      contributions: { jan: '#10B981', today: '#34D399' },
      profit: { jan: '#EF4444', today: '#F87171' },
      roa: { jan: '#0EA5E9', today: '#7DD3FC' },
      liquidity: { jan: '#6366F1', today: '#A5B4FC' }
    };

    const growth = (j, t) => j === 0 ? (t === 0 ? 0 : 100) : ((t - j) / Math.abs(j)) * 100;
    const updateIndicator = (id, g) => {
      const el = document.getElementById(id);
      if (!el) return;
      const arrow = g > 0 ? 'up' : g < 0 ? 'down' : 'right';
      const cls = g > 0 ? 'positive' : g < 0 ? 'negative' : '';
      el.innerHTML = `<i class="fas fa-arrow-${arrow}"></i> ${Math.abs(g).toFixed(1)}%`;
      el.className = `growth-indicator ${cls}`;
    };

    const createChart = (id, j, t, color, gid, isPercent = false, isMoney = false) => {
      if (!document.getElementById(id)) return;
      const g = growth(j, t);
      updateIndicator(gid, g);

      new Chart(document.getElementById(id).getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Jan 2025', 'Today'],
          datasets: [{
            data: [j, t],
            backgroundColor: [color.jan, color.today],
            borderRadius: 12,
            maxBarThickness: 100
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: { 
              callbacks: { 
                label: ctx => {
                  const val = ctx.raw;
                  if (isPercent) return val.toFixed(2) + '%';
                  if (isMoney) return 'KES ' + val.toLocaleString();
                  return val.toLocaleString();
                }
              }
            },
            datalabels: {
              anchor: 'end', align: 'end', offset: 10,
              color: '#1a1a1a', font: { weight: '900', size: 14 },
              formatter: v => isPercent ? v.toFixed(2)+'%' : (isMoney ? 'KES '+v.toLocaleString() : v.toLocaleString()),
              backgroundColor: 'rgba(255,255,255,0.95)', borderRadius: 8, padding: 8
            }
          },
          scales: {
            x: { grid: { display: false }, ticks: { color: '#1a1a1a', font: { weight: 'bold', size: 13 } } },
            y: { display: false, beginAtZero: true, grace: '20%' }
          },
          layout: { padding: { top: 70, left: 10, right: 10, bottom: 10 } }
        },
        plugins: [ChartDataLabels]
      });
    };

    // Calculate derived metrics
    const janROA = parseFloat(jan.roa) || 0;
    const todayROA = parseFloat(today.roa) || 0;
    const janLiquidity = jan.contributions > 0 ? (jan.bankBalance / jan.contributions) * 100 : 0;
    const todayLiquidity = today.contributions > 0 ? (today.bankBalance / today.contributions) * 100 : 0;

    // Create bar charts
    createChart('chartMembers', jan.members, today.members, colors.members, 'growthMembers');
    createChart('chartLoans', jan.loans, today.loans, colors.loans, 'growthLoans', false, true);
    createChart('chartContributions', jan.contributions, today.contributions, colors.contributions, 'growthContributions', false, true);
    createChart('chartProfit', jan.profit, today.profit, colors.profit, 'growthProfit', false, true);
    createChart('chartROA', janROA, todayROA, colors.roa, 'growthROA', true);
    createChart('chartLiquidity', janLiquidity, todayLiquidity, colors.liquidity, 'growthLiquidity', true);

    // Pie chart for loan types
    if (window.loanTypes) {
      const total = window.loanTypes.reduce((s, l) => s + l.value, 0);
      if (total > 0 && document.getElementById('chartLoanTypes')) {
        const labels = window.loanTypes.map(l => l.name);
        const data = window.loanTypes.map(l => (l.value / total) * 100);
        new Chart(document.getElementById('chartLoanTypes').getContext('2d'), {
          type: 'pie',
          data: { 
            labels, 
            datasets: [{ 
              data, 
              backgroundColor: ['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF'], 
              borderWidth: 3, 
              borderColor: '#fff' 
            }] 
          },
          options: {
            responsive: true, 
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom', labels: { font: { size: 12, weight: 'bold' } } },
              datalabels: { 
                formatter: v => v > 5 ? v.toFixed(1)+'%' : '', 
                color: '#fff', 
                font: { weight: 'bold', size: 13 } 
              }
            }
          },
          plugins: [ChartDataLabels]
        });
      }
    }

    console.log('✅ Growth charts rendered successfully');
  }

  // Initialize everything on DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    registerPlugins();  // Ensure plugins are ready

    const init = () => {
      // Restore saccoData if from localStorage (as per your carousel.js)
      if (!window.saccoData && localStorage.getItem('saccoData')) {
        try {
          window.saccoData = JSON.parse(localStorage.getItem('saccoData'));
          console.log('saccoData restored for legacy charts:', window.saccoData);
        } catch (e) {
          console.warn('Failed to restore saccoData:', e);
        }
      }

      if (window.saccoData) {
        renderGrowthCharts();
        if (typeof window.refreshProjections === 'function') window.refreshProjections();
      } else {
        setTimeout(init, 500);  // Retry if data not ready
      }
    };

    // Listen for data updates (e.g., from external scripts)
    window.addEventListener('saccoDataUpdated', init);
    if (typeof initMemberCarousel === 'function') initMemberCarousel();
    init();
  });
</script>
<script src="./scripts/main.js"></script>
<script src="./scripts/calculator.js"></script>
<script src="./scripts/dividendscalculator.js"></script>
<script src="./scripts/chatbot.js"></script>
<script src="./scripts/seo.js"></script>

<!-- SCHEMA & YEAR UPDATE -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FinancialService",
  "name": "SOYOSOYO SACCO",
  "url": "https://soyosoyosacco.com",
  "logo": "https://soyosoyosacco.com/assets/141dd3faa98da9737b591161deac509a.jpg",
  "description": "Affordable 1% monthly loans and high dividends in Coastal Kenya.",
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Kilifi",
    "addressRegion": "Coast",
    "addressCountry": "KE"
  },
  "email": "info@soyosoyosacco.com",
  "areaServed": ["Kilifi", "Mombasa", "Kwale"]
}
</script>

</body>
</html>
